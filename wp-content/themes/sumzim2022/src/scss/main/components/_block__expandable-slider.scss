@use '../common/mixins' as *;
// @use '../abstracts/colors.functions' as *;
@use '../common/typography.mixins' as *;

.expandable-slider {
    margin-bottom: 60px;

    @include breakpoint(medium) {
        margin-bottom: 120px;
    }

    .container {
        display: flex;
        flex-direction: column;
        gap: 24px;
        @include content-wide;

        @include breakpoint(medium) {
            gap: 48px;
        }

        .expandable-slider__header {
            display: flex;
            flex-direction: column;
            gap: 18px;
            

            @include breakpoint(medium) {
                flex-direction: row;
                justify-content: space-between;
                align-items: last baseline;
                gap: unset;
            }

            .expandable-slider__header-group {
                display: flex;
                flex-direction: column;
                gap: 13px;

                @include breakpoint(medium) {
                    gap: 18px;
                }

                .expandable-slider__header-group-heading {
                    margin-left: 0;
                    @include apply-type(heading-lg);
                }    
                
                .expandable-slider__header-group-description {
                    @include apply-type(body);

                    p:last-child {
                        margin-bottom: 0;
                    }
                }                    
            }

            .expandable-slider__header-group-links {
                display: flex;
                gap: calc(22px + 16px);

                @include breakpoint(medium) {
                    gap: calc(24px + 16px);
                    position: relative;
                    margin-right: 16px;
                }

                .expandable-slider__header-group-link-item {
                    .expandable-slider__header-group-link {
                        position: relative;
                        color: blue;
                        font-weight: 500 !important;
                        // @include link-with-arrow(blue, false);
                        @include apply-type(body);

                        &:after {
                            position: absolute;
                            right: -14px;
                            top: 50%;
                            transform: translateY(-50%);
                            width: 16px;
                            height: 12px;
                            content: "";

                        }                        
                    }
                }
            }
        }

        .expandable-slider__body {
            // Break completely out of the container
            position: relative;
            left: 50%;
            right: 50%;
            margin-left: -50vw;
            margin-right: -50vw;
            width: 100vw;
            
            // Prevent horizontal scroll by hiding overflow at this level
            overflow-x: hidden;
            
            // Add padding to align the left edge with container content
            padding-left: calc((100vw - 1223px) / 2 + 24px);
            
            @media (max-width: 1247px) { // 1223px + 24px padding on each side
                padding-left: 24px;
            }

            @include breakpoint(desktop) {
                margin-left: calc(-50vw - 24px);
            }

            .cards-container {
                width: 100%;
                
                .cards-wrapper {
                    overflow: hidden;
                    position: relative;
                    width: 100%;
                }

                .cards {
                    display: flex;
                    gap: 16px;
                    transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 1.0);
                    will-change: transform;
                    margin-bottom: unset;

                    @include breakpoint(medium) {
                        gap: 38px;
                    }

                    .card {
                        position: relative;
                        display: flex;
                        flex-direction: column;
                        flex-shrink: 0;
                        // Mobile: Set specific dimensions for 312x409
                        width: 300px;
                        height: 400px;
                        border-radius: 24px;
                        overflow: hidden;
                        transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 1.0);
                        cursor: default;
                        

                        &:before {
                            content: "";
                            width: 100%;
                            height: 100%;
                            position: absolute;
                            inset: 0;
                            background: var(--bg-image) center/cover no-repeat;
                            z-index: 0;                       
                            transform: scale(1);
                            transition: transform 0.5s ease;
                        }   
                        
                        &:hover:before {
                            transform: scale(1.1);
                        }

                        &:after {
                            content: "";
                            position: absolute;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background: linear-gradient(180deg, rgba(0, 0, 0, 0.00) 40%, rgba(0, 0, 0, 0.50) 65.09%), 50% / cover no-repeat;
                            z-index: 2;
                        }
                        
                        @include breakpoint(medium) {
                            // Use calculation for 3 cards instead of 4
                            // width: calc(25vw - 50px); // Desktop: 3 cards per view
                            aspect-ratio: 3 / 4;
                            
                            
                            &.expanded {
                                width: calc(90vw - 100px); // Much wider expansion - only small peek of next card
                                max-width: 1000px;
                                cursor: default;
                                flex-direction: row;
                                gap: 0;

                                &:after {
                                    background: 
                                        linear-gradient(135deg, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0) 50%),
                                        linear-gradient(180deg, rgba(0, 0, 0, 0) 40%, rgba(0, 0, 0, 0.5) 65.09%);                                    
                                }
                            }
                        }

                        @include breakpoint(desktop) {
                            max-width: 394px;
                            height: 517px;
                        }

                        .card__content {
                            position: absolute;
                            bottom: 0;
                            left: 0;
                            right: 0;
                            padding: 0 16px 24px;
                            z-index: 3;

                            @include breakpoint(medium) {
                                padding: 0 24px 45px;
                            }

                            .card__expanded-content {
                                // Mobile: show content by default, full height for bottom alignment
                                opacity: 1;
                                height: 100%;
                                max-height: unset;
                                display: flex;
                                flex-direction: column;
                                justify-content: flex-end;
                                overflow: visible;
                                transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 1.0);

                                // Desktop: always visible, full height for bottom alignment
                                @include breakpoint(medium) {
                                    opacity: 1;
                                    height: 100%;
                                    max-height: unset;
                                    flex: 1;
                                    display: flex;
                                    flex-direction: column;
                                    justify-content: flex-end; // This ensures bottom alignment
                                    overflow: visible;
                                }

                                .card__expanded-inner {
                                    display: flex;
                                    flex-direction: column;
                                    gap: 12px;
                                    width: 100%;

                                    .card__main-content {
                                        display: flex;
                                        flex-direction: column;
                                        gap: 12px;
                                        width: 100%;

                                        .card__main-content-core {
                                            display: flex;
                                            flex-direction: column;
                                            justify-content: flex-end;
                                            height: 100%;

                                            .card__heading {
                                                color: white;
                                                margin-bottom: 8px;
                                                opacity: 1; // Always visible on both mobile and desktop
                                                margin-left: 0;
                                                @include apply-type(heading-sm);
                                            }

                                            .card__description {
                                                display: none; // Completely hidden by default
                                                color: white;
                                                line-height: 1.6;
                                                max-height: 30%;
                                                @include apply-type(body);

                                                a {
                                                    color: white;
                                                }

                                                p:last-child {
                                                    margin-bottom: 0;
                                                }

                                                &:has(~ .card__link) {
                                                    margin-bottom: 16px;
                                                }
                                            }

                                            .card__link {
                                                display: none; // Completely hidden by default
                                                align-items: center;
                                                gap: 8px;
                                                color: black;
                                                font-weight: 500;
                                                text-decoration: none;
                                                @include apply-type(body);

                                                &:hover {
                                                    // opacity: 0.7;
                                                }

                                                &:after {
                                                    // content: "";
                                                    // width: 16px;
                                                    // height: 12px;
                                                    // @include text-link-arrow(black);
                                                }
                                            }
                                        }

                                        .card__main-content-statistic {
                                            display: none; // Completely hidden by default
                                            
                                            .card__main-content-statistic-proof-point {
                                                color: white;
                                                @include apply-type(display-xl);

                                            }

                                            .card__main-content-statistic-description {
                                                color: white;
                                                @include apply-type(heading-xs);

                                                a { 
                                                    color: white;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }

                        .card__expand-btn {
                            position: absolute;
                            top: 16px;
                            right: 17px;
                            z-index: 3;
                            cursor: pointer;
                            @include button-expand--lg(rgba(white, 1), var(--color__primary--dark));

                            span {
                                display: none;
                            }

                            &:hover {
                                @include button-expand--lg(var(--color__secondary), white);
                            }
                        } 
                        
                        // &:hover {
                        //     .card__expand-btn {
                        //         @include button-expand--lg(blue, black);
                        //     }
                        // }

                        // Close button for expanded state
                        .card__close-btn {
                            position: absolute;
                            top: 16px;
                            right: 16px;
                            width: 32px;
                            cursor: pointer;
                            display: none;
                            z-index: 4; // Higher z-index than expand button
                            @include button-collapse--lg(white, var(--color__primary--dark));

                            &:hover {
                                @include button-collapse--lg(var(--color__secondary), white);
                            }
                        }

                        // Expanded state styles
                        &.expanded {
                            .card__close-btn {
                                span {
                                    display: block;
                                    text-indent: -9999rem;
                                }

                                @include breakpoint(medium) {
                                    display: flex;
                                }
                            }
                            
                            .card__expand-btn {
                                @include breakpoint(medium) {
                                    display: none;
                                }
                            }

                            .card__content {
                                @include breakpoint(medium) {
                                    position: static; // Reset positioning for expanded state
                                    flex: 1;
                                    padding: 24px 32px;
                                    
                                    overflow-y: auto;
                                    display: flex;
                                    flex-direction: column;
                                    justify-content: flex-end;
                                }

                                @include breakpoint(desktop) {
                                    height: 517px;
                                }

                                .card__expanded-content {
                                    // Mobile: show content (already visible by default)
                                    opacity: 1;
                                    max-height: 500px;

                                    @include breakpoint(medium) {
                                        max-height: 517px;
                                    }

                                    .card__expanded-inner {
                                        @include breakpoint(medium) {
                                            flex-direction: row;
                                            gap: 32px;
                                            align-items: flex-end;
                                        }

                                        .card__main-content {
                                            @include breakpoint(medium) {
                                                flex-direction: row;
                                                justify-content: space-between;
                                                align-items: flex-end;
                                            }

                                            .card__main-content-core {

                                                @include breakpoint(medium) {
                                                    max-width: 360px;
                                                }
                                                .card__description {
                                                    display: block; // Show when expanded
                                                }
                                                
                                                .card__link {
                                                    display: inline-flex; // Show when expanded
                                                    max-width: fit-content;
                                                }
                                            }
                                            
                                            .card__main-content-statistic {
                                                display: flex; // Show when expanded
                                                background-color: rgba(0, 0, 0, 0.1);
                                                border-radius: 20px;
                                                padding: 30px 20px;
                                                flex-direction: column;
                                                justify-content: space-between;
                                                aspect-ratio: 290 / 276;
                                                max-width: 290px;

                                                // @media (max-width: 767px) {
                                                //     // Mobile: simpler display for modal
                                                //     display: block;
                                                //     background-color: transparent;
                                                //     border-radius: 0;
                                                //     padding: 0;
                                                //     aspect-ratio: auto;
                                                //     max-width: none;
                                                // }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }

                .cards__nav {
                    display: flex;
                    gap: 42px;
                    align-items: center;
                    margin-top: 32px;
                    // Constrain nav to container width
                    max-width: calc(1223px - 48px); // Container width minus padding
                    padding-right: 24px;
                    
                    @media (max-width: 1247px) {
                        max-width: none;
                        padding-right: 24px;
                    }

                    .cards__nav-progress {
                        height: 2px;
                        background-color: lightgray;
                        position: relative;
                        flex: 1;
                        
                        // Hide on mobile
                        display: none;

                        @include breakpoint(medium) {
                            display: block;
                            max-width: 1070px;
                        }

                        .cards__nav-progress-bar {
                            position: absolute;
                            top: 0;
                            left: 0;
                            height: 2px;
                            background-color: black;
                            transition: width 0.5s cubic-bezier(0.25, 0.46, 0.45, 1.0);
                            width: 0; // Start at 0
                        }
                    }

                    .cards__nav-nav {
                        // Show on mobile, aligned left
                        display: flex;
                        gap: 11px;

                        .cards__nav-nav-prev {
                            background-color: transparent;
                            border: none;
                            transform: rotate(180deg);
                            font-size: 0; // Hides text but not pseudo-elements
                            @include button-arrow--lg(var(--color__primary--dark), white);

                            &:hover:not(.disabled):not([disabled]) {
                                @include button-arrow--lg(var(--color__secondary), var(--color__primary--dark));
                            }                                 

                            &.disabled,
                            &[disabled] {
                                @include button-arrow--lg(lightgray, white);
                            }
                        }

                        .cards__nav-nav-next {
                            background-color: transparent;
                            border: none;
                            font-size: 0; // Hides text but not pseudo-elements
                            @include button-arrow--lg(var(--color__primary--dark), white);

                            &:hover:not(.disabled):not([disabled]) {
                                @include button-arrow--lg(var(--color__secondary), var(--color__primary--dark));
                            }                              

                            &.disabled,
                            &[disabled] {
                                cursor: not-allowed; // Optional: better UX
                                @include button-arrow--lg(lightgray, white);
                            }
                        }
                    }
                }
            }
        }
    }
}

// Mobile modal styles
.card-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(255, 255, 255, 0.8);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    padding: 20px;

    &.active {
        display: flex;
    }

    .card-modal__content {
        // background: white;
        border-radius: 16px;
        width: 100%;
        max-width: 400px;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        display: flex;
        flex-direction: column;

        &:before {
            content: "";
            width: 100%;
            height: 100%;
            position: absolute;
            inset: 0;
            background: var(--bg-image) center/cover no-repeat;
            z-index: 0;                       
            transform: scale(1);
            transition: transform 0.5s ease;
            // @include scale-zoom;
        }  
        
        &:after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.00) 20%, rgba(0, 0, 0, 0.50) 65.09%), 50% / cover no-repeat;
            z-index: 1;                        
        }

        .card-modal__close {
            position: absolute;
            top: 16px;
            right: 16px;
            cursor: pointer;
            z-index: 2;
            @include button-close--lg(white, black);

            span {
                display: block;
                text-indent: -9999rem;
            }


        }

        .card-modal__image {
            width: 100%;
            aspect-ratio: 394 / 200; // Updated to match new card proportions
            object-fit: cover;
        }

        .card-modal__body {
            padding: 24px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            flex: 1;
            z-index: 2;

            .card-modal__title {
                margin-bottom: 14px;
                color: white;
                margin-left: 0;
                @include apply-type(heading-md);
            }

            .card-modal__description {
                
                line-height: 1.6;
                color: white;
                @include apply-type(body);

                p:last-child {
                    margin-bottom: 0;
                }

                &:has(~ .card-modal__link) {
                    margin-bottom: 44px;
                }
            }

            .card-modal__link {
                display: inline-flex;
                // align-items: center;
                // gap: 8px;
                // color: black;
                // font-weight: 500;
                // text-decoration: none;
                max-width: fit-content;
                @include apply-type(body);
            }

            .card-modal__stats {
                display: flex; // Show when expanded
                background-color: rgba(0, 0, 0, 0.2);
                border-radius: 20px;
                padding: 30px 20px;
                flex-direction: column;
                justify-content: space-between;
                width: 100%;
                height: 181px;    
                margin-top: 36px;   

                .card__main-content-statistic-proof-point {
                    color: white;
                    @include apply-type(display-xl);
                }

                .card__main-content-statistic-description {
                    color: white;
                    @include apply-type(heading-xs);
                }

            }
        }
    }
}